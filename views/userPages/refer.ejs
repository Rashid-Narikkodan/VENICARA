<%-include('../partials/user/header.ejs')%>
<%-include('../partials/user/sidebarProfile.ejs')%>
      <style>
    .referral-card {
      background: #ffffff;
      border-radius: 15px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.1);
      text-align: center;
      padding: 5rem 3rem;
      width: 70%;
    }

    .referral-card p {
      font-size: 1.05rem;
      margin-bottom: 8px;
      font-weight: 600;
    }

    .referral-card small {
      color: #6c757d;
      display: block;
      margin-bottom: 20px;
    }

    .referral-code {
      font-weight: bold;
      letter-spacing: 2px;
      border: 2px dashed #aaa;
      padding: 12px 18px;
      border-radius: 6px;
      margin-bottom: 25px;
      display: inline-block;
      background: #fafafa;
    }

    .btn-refer {
      border-radius: 8px;
      font-weight: 600;
      background: #444;
      border: none;
      padding: 12px 0;
      width: 100%;
      transition: all 0.3s ease;
    }

    .btn-refer:hover {
      background: #222;
    }
    .reward-card{
      background: #ffffff;
      border-radius: 15px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.1);
      text-align: center;
      padding: 2rem 2rem;
      width: 30%;
    }
    @media (max-width:576px){
    .referral-card {
      padding: 3rem 3rem;
      width: 100%;
    }
    .reward-card{
      padding: 3rem 3rem;
      width: 100%;
    }

    }
  </style>
<main class="d-flex flex-sm-row flex-column justify-content-center w-100 h-75">
  <div class="referral-card shadow">
    <p class="fw-bold fs-3">REFER & EARN</p>
    <img src="/images/Screenshot 2025-09-11 153150.png" alt="Referral Icon">
    <p>Refer now and Earn up to Rs.200</p>
    <small>Send a referral Message to your friend, Collect your Reward</small>
    <div class="referral-code"><%=referralCode%></div>
    <button class="btn btn-refer rounded-pill text-white" onclick="copy(this)">Refer Now, Click to Copy Message</button>
  </div>
  <%if(rewards&&rewards.length){%>
    <div class="reward-card ms-md-3 ms-0 mt-3 mt-md-0" style="background: rgb(218, 218, 218);">
      <p class="fs-3 fw-bold">Rewards</p>                <!-- coupons -->
      <div id="couponList" class="list-group">
        <!-- Example coupon -->
        <%rewards.forEach(reward=>{%>
          <div class="list-group-item d-flex justify-content-between align-items-center rounded-4 mb-2 shadow-sm">
            <div>
              <span class="fw-bold text-start">Referral Reward</span>
              <small class="d-block text-muted">Get â‚¹<%=reward.amount%> as Referral reward</small>
            </div>
            <button 
              class="btn btn-dark btn-sm rounded-pill claim-reward px-3" 
              data-id="<%= reward._id %>"
              <%= (reward.status === 'claimed' || reward.status === 'pending') ? 'disabled' : '' %>>
              <%= reward.status.charAt(0).toUpperCase() + reward.status.slice(1) %>
            </button>
          </div>
        <%})%>
      </div>
    </div>
  <%}%>
</main>
</div>
<script>
  function copy(btn){
    const copy='<%=referralCode%>'
    const message=`Join Venicara and earn rewards! Use my referral code: ${copy}`;
    navigator.clipboard.writeText(message).then(()=>{
      btn.innerText = 'Referral message copied! Now share it to anyone and Earn your reward'
    })
    setTimeout(()=>btn.innerText = 'Refer Now, Click to Copy Message',2000)
  }

  document.getElementById('couponList').addEventListener('click',async(e)=>{
    if(e.target.classList.contains('claim-reward')){
      const id=e.target.getAttribute('data-id')
      const res=await fetch('/referEarn/api/reward',{
        method:"PATCH",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({id})
      })
      const data=await res.json()
      if(data.status){
        e.target.innerText = data.message
        e.target.disabled=true
      }else{
        showAlert('error',data.message || "Failed to claim");
      }
    }
  })
  </script>
</body>
</html>