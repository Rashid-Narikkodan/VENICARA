<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>VENICARA | OTP verification</title>
   <link rel="shortcut icon" href="/images/fevicon.png" type="image/x-icon">
  <link
   href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css"
   rel="stylesheet"
  />
<link rel="stylesheet" href="/css/userAuth.css" />
</head>
  <body class="vh-100 d-flex align-items-center bg-dark">
      <div class="container-fluid text-center d-flex justify-content-center">
        <div class="card shadow-lg border-0 rounded-5 overflow-hidden mt-3 p-5 d-flex justify-content-center" style="max-width: 800px; width: 100%">
          <%if(messages.success.length>0){%>
              <div id="success-otp" class="alert alert-success successOTP"><%=messages.success[0]%></div>
            <%}%>
             <%if(messages.error.length>0){%>
              <div id="success-otp" class="alert alert-danger successOTP"><%=messages.error[0]%></div>
            <%}%>
          <div class="row g-0 d-flex justify-content-center pt-md-5 pb-md-5">
            <div class="col-12 mb-md-3">
              <h1 class="">Confirm with OTP</h1>
              <p>Please check your mail address for OTP</p>
            </div>
            <div class="col-12 col-sm-6 mt-3">
              <form action="/profile/OTP" method="post" class="">
                <input type="text" name="otp" placeholder="Enter OTP" class="p-3 mb-md-3 text-center w-100 form-control fs-3" maxlength="6">
                <div class="mb-3 mt-3">
                  <span>Remaining Time <span id="timer" style="color:blueviolet" >00:50s</span></span>
                  <br class="d-md-none d-block">
                  <span class="ms-md-5">Didnâ€™t you receive code? <a href="#" id="resend-otp" class="text-decoration-none"><span style="color:blueviolet">Resend</span></a></span>
                </div>
                <button class="btn btn-dark w-75  mb-3 p-md-3 p-2" type="submit">Confirm</button>
              </form>
            </div>
            <div class="col-12">
              <a href="/profile/verify" class="text-decoration-none" style="color:blueviolet">Go back to Email verify page</a>
            </div>
          </div>
        </div>
      </div>
      <script>
        //signup otp  timer
const resend = document.getElementById('resend-otp');

resend.addEventListener('click', async (e) => {
  e.preventDefault();
  resend.innerHTML = 'Sending...';
  resend.style.pointerEvents = 'none';

  try {
    const response = await fetch('/profile/resentOTP', {
      method: "POST",
    });

    const data = await response.json(); // <-- await here

    if (data.success) {
      resend.innerHTML = 'Resend';
      startTimer(50); // start countdown from 50 seconds
    } else {
      alert(data.message || "Something went wrong");
      // resend.innerHTML = 'Resend';
      resend.style.pointerEvents = 'auto';
    }
  } catch (err) {
    console.error(err);
    resend.innerHTML = 'Resend';
    resend.style.pointerEvents = 'auto';
  }
});

let timerId;

function startTimer(seconds) {
  if (timerId) clearInterval(timerId); // clear previous timer
  const timer = document.getElementById('timer');
  let i = seconds;

  timer.innerHTML = `00:${i < 10 ? '0' + i : i}s`; // initial display

  timerId = setInterval(() => {
    i--;
    timer.innerHTML = `00:${i < 10 ? '0' + i : i}s`;
    if (i <= 0) {
      clearInterval(timerId);
      timer.innerHTML = `00:50s`
      resend.innerHTML = 'Resend';
      resend.style.pointerEvents = 'auto';
    }
  }, 1000);
}
const successOTP=document.getElementById('success-otp')
if(successOTP.textContent!==''){
  const id=setTimeout(()=>{
    successOTP.classList.add('fade-out')
    successOTP.addEventListener('transitionend',()=>{
      successOTP.remove()
    })
  },3000)
}

      </script>
  </body>
</html>